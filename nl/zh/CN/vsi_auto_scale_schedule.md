---

copyright:
  years: 2014, 2019
lastupdated: "2019-06-07"

keywords:

subcollection: virtual-servers

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# 使用基于调度的自动缩放管理流量峰值
{: #managing-schedule-based-auto-scaling}

Web 流量峰值有好的一面，也有坏的一面。从好的一面来说，峰值意味着有更多用户在使用您的站点；但从坏的一面来说，活动激增会影响响应时间。{{site.data.keyword.cloud}} 自动缩放提供了自动扩展或缩减服务器的能力，以支持您的业务需要。您可以使用基于调度的自动缩放来控制这些流量峰值。
{:shortdesc}

## 开始之前
首先，导航至设备菜单，并确保您具有完成任务的正确帐户许可权。

* 导航至控制台的设备菜单。有关更多信息，请参阅[导航至设备](/docs/vsi?topic=virtual-servers-navigating-devices)。
* 确保您具有任何必需的帐户许可权和设备访问权。如果您不是帐户管理员，那么您的用户帐户必须包含使用自动缩放的许可权。 有关更新许可权以使用自动缩放的更多信息，请参阅[设置自动缩放的用户许可权](/docs/vsi?topic=virtual-servers-user-permissions-required-to-use-auto-scale)。只有帐户所有者或具有**管理用户**经典基础架构许可权的用户才能调整许可权。 

有关许可权的更多信息，请参阅[经典基础架构许可权](/docs/iam?topic=iam-infrapermission#infrapermission)和[管理设备访问权](/docs/vsi?topic=virtual-servers-managing-device-access)。

## 添加自动缩放组
{: #add-auto-scale-group}

在此场景中，一家位于得克萨斯州达拉斯的社交 Web 站点在周末会遇到活动峰值。周一到周五该站点至少需要两个虚拟服务器；但是，每个周末需要额外的两个虚拟服务器，以应对增加的流量。以下步骤将引导您逐步设置自动缩放以支持基于安排的缩放。

1. 从**设备**菜单中，选择**自动缩放**。
2. 选择**添加自动缩放组**。
3. 通过首先输入**组名**（例如，Weekend Scale Up 组）来设置自动缩放组，然后选择数据中心。
4. 选择服务器终止策略。例如，如果选择**最旧**，那么在缩减时会选择供应日期最早的服务器。
5. 指示组是否为多 VLAN 缩放组，以及如何在已配置的 VLAN 对中均衡缩减。
6. 选择要在其中供应服务器的公用和专用 VLAN。如果要从公用因特网访问服务器（如果 VLAN 正在运行 Web 服务器），请使**仅专用网络**保留为未选中状态。
7. 将**最小成员计数**设置为 2，将**最大成员计数**设置为 4。将**冷却时间段**设置为 0。因为这是基于安排的缩放，所以没有收集任何统计信息来触发缩放操作。

## 为组定义成员配置
{: #define-member-configuration}

1. 找到**成员配置**，然后输入缩放服务器的**主机名**和**域**。添加到该组的后续服务器会在主机名后附加唯一后缀。
2. 指定计算实例的硬件配置（核心数、RAM 等）。
3. 如果要安装最简操作系统，请选择操作系统。还可以使用公共映像或专用映像来供应实例。
4. 如果实例需要额外的步骤来安装其他软件，请指定安装后脚本的 URL 来安装该软件。（如果对该组使用负载均衡器，那么会先运行安装后脚本，然后将成员置于负载均衡器后面。）

## 设置策略
{: #set-up-policies}

在此场景中，该社交 Web 站点使用的是基于安排的缩放。需要两个策略：一个策略用于在周五下午扩展服务器，另一个策略用于在周日晚上缩减服务器。第一个策略是扩展服务器。

1. 找到**策略**，然后单击**添加策略**。输入**策略名称** (Friday Scale Up)。
2. 对于**冷却时间段**，选择组冷却时间段选项。
3. 单击**添加触发器**，然后通过在第一个下拉菜单中选择**频率**来指定重复触发器，然后从后续下拉菜单中选择**周五**以及**晚上 10:00**\*。（**高级编辑**复选框允许您以类似 crontab 的表示法输入触发器频率。）
4. 单击**操作**下的**缩放方式**下拉框，然后选择**相对**。在**成员**字段中输入 2。
5. 再次单击**添加策略**以指定第二个策略，此策略用于在周日晚上缩减服务器。冷却时间段与组的冷却时间段相同。触发器是每周日凌晨 1:00* 触发，相对缩放操作为 -2。
6. 在**触发器**字段中输入的时间是基于 UTC 时间的，因此您需要选择晚上 10:00（相当于中部夏令时下午 5:00）和凌晨 1:00（相当于中部夏令时晚上 8:00）。对于中部标准时间，这两个时间将分别为早上 9:00 和中午 12:00，因为 UTC/GMT 不接受夏令时。请参阅[世界时间服务器 ![外部链接图标](../../icons/launch-glyph.svg "外部链接图标")](http://www.worldtimeserver.com/current_time_in_UTC.aspx){: new_window} 站点以获取时间转换器。

## 添加本地负载均衡器

如果设置了本地负载均衡器，那么可以将其用于对自动缩放组进行负载均衡。

1. 找到**本地负载均衡器**，然后单击**添加负载均衡器**。
2. 单击**查看 VIP 设置**（打开一个单独的页面）以查看帐户中可用的本地负载均衡器，并根据需要订购新的负载均衡器。负载均衡器需要有关联的服务组才可用于自动缩放组。确保负载均衡器位于自动缩放组所在的数据中心。
3. 在**添加自动缩放组**页面上单击**添加负载均衡器**，单击“虚拟 IP”的下拉箭头，然后选择负载均衡器。
4. 单击**服务组**、**服务端口**和**服务运行状况检查类型**的下拉箭头，然后选择相应的值。
5. 单击**添加组**以保存组。
6. 如果正确指定了所有数据中心、网络等，那么会创建自动缩放组。单击**查看所有组**屏幕上的组可查看组的详细信息。

设置基于安排的缩放的结果是，会自动供应两个成员以满足 Web 站点的最低需求。在中部时间周五下午 5:00，第一个策略触发器触发时，将自动供应另外两个成员。然后，在中部时间周日晚上 8:00，通过触发第二个策略触发器，回收两个成员。如果指定了负载均衡器，那么在运行定制安装后脚本后，创建的所有成员（包括创建的成员和周五添加的成员）都会位于负载均衡器后面。
