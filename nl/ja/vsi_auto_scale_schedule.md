---

copyright:
  years: 2014, 2019
lastupdated: "2019-06-07"

keywords:

subcollection: virtual-servers

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# スケジュール・ベースのオート・スケールを使用したトラフィック・スパイクへの対処
{: #managing-schedule-based-auto-scaling}

Web トラフィック・スパイクには、良い面と悪い面があります。 多くの人がサイトを利用しているという意味ではスパイクは良いものですが、アクティビティーの急増が応答時間に影響を及ぼす可能性があるという点では悪いものである可能性もあります。 {{site.data.keyword.cloud}} オート・スケールを使用すると、サーバーを自動的にスケールアップ/スケールダウンしてビジネス・ニーズに対応することができます。 スケジュール・ベースのオート・スケールを使用して、このようなトラフィック・スパイクを制御することができます。
{:shortdesc}

## 始めに
まず、デバイス・メニューに移動して、タスクを実行するための適切なアカウント権限を持っていることを確認します。

* コンソールのデバイス・メニューに移動します。詳しくは、[デバイスへのナビゲート](/docs/vsi?topic=virtual-servers-navigating-devices)を参照してください。
* 必要なアカウント権限とデバイス・アクセス権限を持っていることを確認します。アカウント管理者でない場合は、オート・スケールの使用権限を持つユーザー・アカウントを使用する必要があります。オート・スケールの使用権限を更新する方法について詳しくは、[オート・スケールのユーザー権限のセットアップ](/docs/vsi?topic=virtual-servers-user-permissions-required-to-use-auto-scale)を参照してください。アカウントの所有者、またはクラシック・インフラストラクチャーの**「ユーザーの管理」**権限を持つユーザーのみが、権限を調整できます。 

権限について詳しくは、[クラシック・インフラストラクチャー許可](/docs/iam?topic=iam-infrapermission#infrapermission)および[デバイス・アクセスの管理](/docs/vsi?topic=virtual-servers-managing-device-access)を参照してください。

## オート・スケール・グループを追加する
{: #add-auto-scale-group}

このシナリオでは、テキサス州のダラスを拠点とするソーシャル Web サイトに週末の間アクティビティー・スパイクが発生しているとします。 月曜日から金曜日までは、このサイトに必要な最少の仮想サーバー数は 2 台ですが、毎週末、トラフィックの増加に対応するために 2 台の仮想サーバーが追加で必要になります。 ここでは、スケジュール・ベースのスケーリングをサポートするようにオート・スケールをセットアップする手順を説明します。

1. **「デバイス」**メニューから**「オート・スケール」**を選択します。
2. **「オート・スケール・グループの追加」**を選択します。
3. まずは**グループ名** (例: Weekend Scale Up Group) を入力してオート・スケール・グループをセットアップし、データ・センターを選択します。
4. サーバー終了ポリシーを選択します。 例えば、**「最古」**を選択した場合は、プロビジョン日が最も古いサーバーがスケールダウン時に選択されます。
5. グループをマルチ VLAN スケール・グループにするかどうか、構成した VLAN ペアの間でスケールダウンのバランスをどのように取るかを指定します。
6. サーバーをプロビジョンするパブリック VLAN とプライベート VLAN を選択します。 サーバーにパブリック・インターネットからアクセスする場合 (VLAN で Web サーバーを実行する場合) は、**「プライベート・ネットワークのみ」**をクリアしたままにしておきます。
7. **「最小メンバー数」**を 2、**「最大メンバー数」**を 4 に設定します。**「クールダウン期間」**は 0 に設定します。これはスケジュール・ベース・スケーリングなので、スケーリング・アクションをトリガーするための統計は収集されないからです。

## グループのメンバー構成を定義する
{: #define-member-configuration}

1. **「メンバーの構成」**を見つけ、スケーリング・サーバーの**ホスト名**と**ドメイン**を入力します。 グループに追加される後続のサーバーは、このホスト名に固有の接尾部が付加されたものになります。
2. コンピューティング・インスタンスのハードウェア構成 (コア、RAM など) を指定します。
3. 最小のオペレーティング・システムをインストールする場合は、オペレーティング・システムを選択します。 パブリック・イメージまたはプライベート・イメージを使用してインスタンスをプロビジョンすることもできます。
4. 追加のソフトウェアをインストールする追加の手順が必要なインスタンスの場合は、ポスト・インストール・スクリプトの URL を指定してソフトウェアをインストールします (グループにロード・バランサーを使用する場合は、ポスト・インストール・スクリプトが実行された後にメンバーがロード・バランサーの内側に置かれます)。

## ポリシーをセットアップする
{: #set-up-policies}

このシナリオでは、ソーシャル Web サイトはスケジュール・ベースのスケーリングを使用します。 2 つのポリシーが必要です。1 つは毎週金曜日の午後にサーバーをスケールアップするためのポリシー、もう 1 つは毎週日曜日の夜にサーバーをスケールダウンするためのポリシーです。 最初のポリシーは、サーバーをスケールアップするものです。

1. **「ポリシー」**を見つけ、**「ポリシーの追加」**をクリックします。 **ポリシー名** (Friday Scale Up) を入力します。
2. **「クールダウン期間」**にはグループ・クールダウン・オプションを選択します。
3. **「トリガーの追加」**をクリックし、最初のドロップダウン・メニューで**「毎」**を選択して繰り返しトリガーを指定し、その次のドロップダウン・メニューから**「金曜」**と**「10:00 PM」**\* を選択します (**「拡張編集」**チェック・ボックスを使用すると、crontab のような表記でトリガー頻度を入力できます)。
4. **「アクション」**下の**「スケール基準」**ドロップダウン・ボックスをクリックし、**「相対」**を選択します。 **「メンバー」**フィールドに 2 を入力します。
5. **「ポリシーの追加」**をもう一度クリックし、毎週日曜日の夜にサーバーをスケールダウンする 2 番目のポリシーを指定します。 クールダウン期間はグループのクールダウンと同じです。 トリガーは毎週日曜日の 1:00 AM* で、相対スケール・アクションは -2 です。
6. **「トリガー」**フィールドに入力する時刻は UTC 時刻に基づく時刻です。中央夏時間 5:00 PM の代わりに 10:00 PM を選択し、中央夏時間 8:00 PM の代わりに 1:00 AM を選択する必要があるのはそのためです。 UTC/GMT では夏時間調整が認識されないため、中央標準時の期間は、時刻は 9:00 AM と 12:00 AM になります。 タイム・コンバーターについては、[World Time Server ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](http://www.worldtimeserver.com/current_time_in_UTC.aspx){: new_window} サイトを参照してください。

## ローカル・ロード・バランサーを追加する

ローカル・ロード・バランサーをセットアップした場合は、それを使用してオート・スケール・グループのロード・バランシングを行うことができます。

1. **「ローカル・ロード・バランサー」**を見つけ、**「ロード・バランサーの追加」**をクリックします。
2. **「VIP 設定の表示」**をクリックして (別のページが開きます)、アカウントで使用可能なローカル・ロード・バランサーを確認し、必要に応じて新しいロード・バランサーを注文します。 オート・スケール・グループで使用するサービス・グループがロード・バランサーに関連付けられている必要があります。 オート・スケール・グループのデータ・センターにロード・バランサーがあることを確認してください。
3. **「オート・スケール・グループの追加」**ページで**「ロード・バランサーの追加」**をクリックし、「仮想 IP」のドロップダウン矢印をクリックして、ロード・バランサーを選択します。
4. **「サービス・グループ」**、**「サービス・ポート」**、**「サービス・ヘルス・チェックのタイプ」**の各ドロップダウン矢印をクリックし、適切な値を選択します。
5. **「グループの追加」**をクリックしてグループを保存します。
6. データ・センターやネットワークなどがすべて正しく指定されていれば、オート・スケール・グループが作成されます。 **「すべてのグループの表示」**画面でグループをクリックすると、グループの詳細が表示されます。

スケジュール・ベースのスケーリングをセットアップした結果として、Web サイトの最小要件を満たすように 2 つのメンバーが自動的にプロビジョンされます。 毎週金曜日、中央時間 5:00 PM になると、最初のポリシー・トリガーが起動され、さらに 2 つのメンバーが自動的にプロビジョンされます。 その後、毎週日曜日、中央時間 8:00 PM になると、2 番目のポリシー・トリガーによって 2 つのメンバーが回収されます。 ロード・バランサーを指定した場合、作成時や金曜日に作成されるすべてのメンバーは、カスタムのポスト・インストール・スクリプトが実行された後にロード・バランサーの内側に置かれます。
