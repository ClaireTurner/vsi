---

copyright:
  years: 2014, 2019
lastupdated: "2019-06-07"

keywords:

subcollection: virtual-servers

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# リソース・ベースのオート・スケールを使用したトラフィック・スパイクへの対処
{: #managing-resourced-based-auto-scaling}

新製品を販売したり、既存の製品のセールを実施したりすると、Web サイトのトラフィックにスパイクが発生することがあります。 トラフィックにスパイクが発生すると、応答時間に影響を及ぼし、ひいては Web サイトのカスタマー・エクスペリエンスに影響が及ぶ可能性があります。 {{site.data.keyword.cloud}} オート・スケールを利用すれば、トラフィックのスパイクに自動的に対応できます。 リソース・ベースのオート・スケールを使用して、このようなトラフィック・スパイクを制御することができます。
{:shortdesc}

## 始めに
まず、デバイス・メニューに移動して、タスクを実行するための適切なアカウント権限を持っていることを確認します。

* コンソールのデバイス・メニューに移動します。詳しくは、[デバイスへのナビゲート](/docs/vsi?topic=virtual-servers-navigating-devices)を参照してください。
* 必要なアカウント権限とデバイス・アクセス権限を持っていることを確認します。アカウント管理者でない場合は、オート・スケールの使用権限を持つユーザー・アカウントを使用する必要があります。オート・スケールの使用権限を更新する方法について詳しくは、[オート・スケールのユーザー権限のセットアップ](/docs/vsi?topic=virtual-servers-user-permissions-required-to-use-auto-scale)を参照してください。アカウントの所有者、またはクラシック・インフラストラクチャーの**「ユーザーの管理」**権限を持つユーザーのみが、権限を調整できます。 

権限について詳しくは、[クラシック・インフラストラクチャー許可](/docs/iam?topic=iam-infrapermission#infrapermission)および[デバイス・アクセスの管理](/docs/vsi?topic=virtual-servers-managing-device-access)を参照してください。

## オート・スケール・グループを追加する
{: #adding-auto-scale-group}

例えば、テキサス州のダラスを拠点とする e-コマース Web サイトが常時 3 台の仮想サーバーをオンラインにする必要があるとします。この会社がオンライン・セールを実施する平日の午前 9:00 から午後 5:00 までの間に、取引のスパイクが発生します。 この時間帯は、Web サイトの応答時間を維持するために、追加の仮想サーバーが 3 台必要になります。 また、すべての仮想サーバーのパブリック・インバウンド・トラフィックの平均が 5 MB/秒を超える状態が 10 分間続いた場合は、追加の仮想サーバーを 2 台プロビジョンする必要があります。 トラフィックが 5 MB/秒未満になったら、それらの追加仮想サーバーをキャンセルして除去する必要があります。 目標は、トラフィックの急増に対応する仮想サーバーを 5 台以下にして、平日の仮想サーバーが平日の追加トラフィックの影響を受けないようにすることです。 ここでは、リソース・ベースのスケーリングをサポートするようにオート・スケールをセットアップする手順を説明します。

1. **「デバイス」**メニューから**「オート・スケール」**を選択します。
2. **「オート・スケール・グループの追加」**を選択します。
3. まずは**グループ名** (例: Weekend Scale Up Group) を入力してオート・スケール・グループをセットアップし、データ・センターを選択します。
4. サーバー終了ポリシーを選択します。 例えば、**「最古」**を選択した場合は、プロビジョン日が最も古いサーバーがスケールダウン時に選択されます。
5. グループをマルチ VLAN スケール・グループにするかどうか、構成した VLAN ペアの間でスケールダウンのバランスをどのように取るかを指定します。
6. サーバーをプロビジョンするパブリック VLAN とプライベート VLAN を選択します。 サーバーにパブリック・インターネットからアクセスする場合 (VLAN で Web サーバーを実行する場合) は、**「プライベート・ネットワークのみ」**をクリアしたままにしておきます。
7. **「最小メンバー数」**を 3、**「最大メンバー数」**を 6 に設定します。**「クールダウン期間」**は 0 に設定します。これはスケジュール・ベース・スケーリングなので、スケーリング・アクションをトリガーするための統計は収集されないからです。

## グループのメンバー構成を定義する
{: #defining-member-configuration}

1. **「メンバーの構成」**を見つけ、スケーリング・サーバーの**ホスト名**と**ドメイン**を入力します。 グループに追加される後続のサーバーは、このホスト名に固有の接尾部が付加されたものになります。
2. コンピューティング・インスタンスのハードウェア構成 (コア、RAM など) を指定します。
3. 最小のオペレーティング・システムをインストールする場合は、オペレーティング・システムを選択します。 **「パブリック・イメージ」**または**「プライベート・イメージ」**を使用して、インスタンスをプロビジョンすることもできます。
4. 追加のソフトウェアをインストールする追加の手順が必要なインスタンスの場合は、**「ポスト・インストール・スクリプト」**の URL を指定してソフトウェアをインストールします。 (グループにロード・バランサーを使用する場合は、ポスト・インストール・スクリプトが実行された後にメンバーがロード・バランサーの内側に置かれます)。

## ポリシーをセットアップする
{: #setting-up-policies}

このシナリオでは、e-コマース Web サイトでリソース・ベースのスケーリングを使用します。 2 つのポリシーが必要です。1 つは必要な時間フレームに相対スケール・アクション +3 を実行するポリシー、もう 1 つはスパイクの終了時に絶対アクション 3 を実行するポリシーです。 最初のポリシーは、リソースを追加するためのものです。

1. **「ポリシー」**までスクロールダウンし、**「ポリシーの追加」**をクリックします。 **「ポリシー名」**に「Weekday Scale Up」と入力します。
2. **「クールダウン期間」**にはグループ・クールダウン・オプションを選択します。
3. **「トリガーの追加」**をクリックし、最初のドロップダウン・メニューで**「毎」**を選択して繰り返しトリガーを指定し、その次のドロップダウン・ボックスで**「月曜」、「火曜」、「水曜」、「木曜」、****「金曜」**と **2:00 PM**\* を強調表示します (**「拡張編集」**チェック・ボックスを使用すると、crontab のような表記でトリガー頻度を入力できます)。
4. **「アクション」**下の**「スケール基準」**ドロップダウン・ボックスをクリックし、**「正確」**を選択します。 **「メンバー」**フィールドに 3 を入力します。
5. **「ポリシーの追加」**をもう一度クリックし、毎日午後にサーバーを除去する 2 つ目のポリシーを指定します。 クールダウン期間はグループのクールダウンと同じです。 トリガーは毎週月曜、火曜、水曜、木曜、金曜の 10:00 PM\* で、正確なスケール・アクション 3 を指定します。**「トリガー」**フィールドに入力する時刻は、UTC 時刻に基づく時刻です。中央夏時間 9:00 AM の代わりに 2:00 PM、中央夏時間 5:00 PM の代わりに 10:00 PM を選択する必要があるのはそのためです。 UTC/GMT では夏時間調整が認識されないため、中央標準時の期間は、時刻は 1:00 PM と9:00 PM になります。 タイム・コンバーターについては、[World Time Server ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](http://www.worldtimeserver.com/current_time_in_UTC.aspx){: new_window} サイトを参照してください。
6. クールダウン 0 の別のグループをセットアップします。その名前を「Traffic Burst Group」などとし、最小メンバー数を 0、最大メンバー数を 5 にします。グループとメンバーの構成については、グループ名を除き、Weekday Scale Up グループと同じ設定を使用します。
7. すべての仮想サーバーのパブリック・インバウンド・トラフィックの平均が 5 MB/秒を超える状態が 10 分間続いた場合に 2 台の追加サーバーを制御する 2 つ目のポリシーを追加するために、**「ポリシーの追加」**をクリックします。
8. **「ポリシー名」**に「Traffic Burst Group」などと入力します。
9. **「クールダウン期間」**にはグループ・クールダウン・オプションを選択します。
10. **「トリガーの追加」**をクリックします。 最初のボックスはデフォルトの**「自分のリソースの使用状況」**のままにし、2 番目のボックスで**「パブリック・ネットワークの着信 Mbps」**を選択します。 3 番目のボックスは、デフォルトの > 記号のままにします。 4 番目のボックスに **5** (5 MB) を入力し、5 番目のボックスに **600** を入力し、最後のボックスで**「秒」**を選択して 10 分を表すようにします。
11. **「アクション」**下の**「スケール基準」**ドロップダウン・ボックスをクリックし、**「相対」**を選択します。 **「メンバー」**フィールドに 2 を入力します。
12. **「ポリシーの追加」**をもう一度クリックし、トラフィックが 5 Mbps\* 未満に減少したときにサーバーを除去する 2 つ目のポリシーを指定します。クールダウン期間はグループのクールダウンと同じにします。 トリガー条件は、600 秒 (10 分) の間にパブリック・ネットワークの着信 Mbps が 5 (5 Mbps) 未満になることです。

両方のグループを作成すると、Weekday Scale Up グループによって 3 台のサーバー (最小) が作成されます。 平日は、9:00 AM (中央標準時) に 3 台のサーバーが追加され、5:00 PM (中央標準時) にそれらのサーバーが除去されます。 このグループのメンバーを追加/除去する方法は他にはありません。 完全に別の Traffic Burst Group によって、すべてのメンバーのインバウンド・パブリック・トラフィックの平均が 5 MB/秒である状態が 10 分間続くたびに 2 台のサーバーが追加されます。これは、このグループの最大数 5 に達するまで行われます。 10 分の間にインバウンド・パブリック・トラフィックがこの量を下回ると、このグループのすべてのサーバーが除去されます。

